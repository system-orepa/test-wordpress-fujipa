{"version":3,"sources":["admin-analytics-helper.js"],"names":["jQuery","document","ready","$","gaProfile","parent","callback","td","parents","addClass","ajax","type","url","Gianalytics","endpoint","dataType","data","nonce","action","target","attr","replace","account_id","val","profile_id","success","result","removeClass","select","each","items","index","item","opt","createElement","id","text","name","append","window","alert","message","change","threshold","parseInt","this","elt","find","i","option","remove","accountSelect","length","profileSelect","prop","viewSelect","checkGaStatus","submit","e","preventDefault","form","ajaxSubmit","JSON","stringify","key","value","error","xhr","status","msg","$form","$checked"],"mappings":"AAMAA,OAAOC,UAAUC,MAAM,SAAUC,GAE/B,YAGA,IAAIC,GAAY,SAASC,EAAQC,GAC/B,GAAIC,GAAKJ,EAAEE,GAAQG,QAAQ,KAC3BD,GAAGE,SAAS,WACZN,EAAEO,MACAC,KAAM,MACNC,IAAKC,YAAYC,SACjBC,SAAU,OACVC,MACEC,MAAOJ,YAAYI,MACnBC,OAAQL,YAAYK,OACpBC,OAAQhB,EAAEE,GAAQe,KAAK,MAAMC,QAAQ,MAAO,IAC5CC,WAAYnB,EAAE,eAAeoB,MAC7BC,WAAYrB,EAAE,eAAeoB,OAE/BE,QAAS,SAASC,GAEhB,GADAnB,EAAGoB,YAAY,WACXD,EAAOD,QAAS,CAClB,GAAIG,GAASzB,EAAE,IAAMA,EAAEE,GAAQe,KAAK,cACpCjB,GAAE0B,KAAKH,EAAOI,MAAO,SAASC,EAAOC,GACnC,GAAIC,GAAMhC,SAASiC,cAAc,SACjC/B,GAAE8B,GAAKb,KAAK,QAASY,EAAKG,IAAIC,KAAKJ,EAAKK,MACxCT,EAAOU,OAAOL,KAEZ3B,GACFA,EAASsB,OAGXW,QAAOC,MAAMd,EAAOe,YAO5BtC,GAAE,qBAAsB,kBAAkBuC,OAAO,WAC/C,GAAIC,GAAYC,SAASzC,EAAE0C,MAAMzB,KAAK,qBAAsB,GAE5DjB,GAAE,SAAU,kBAAkB0B,KAAK,SAASE,EAAOe,GAC7Cf,GAASY,GACXxC,EAAE2C,GAAKC,KAAK,UAAUlB,KAAK,SAASmB,EAAGC,GACjCD,EAAI,GACN7C,EAAE8C,GAAQC,aAMlB9C,EAAUyC,OAIZ,IAAIM,GAAgBhD,EAAE,cAClBgD,GAAcC,QAAU,MAAQD,EAAc/B,KAAK,uBACrDhB,EAAU+C,EAAe,SAASE,GAChCA,EAAcN,KAAK,UAAUlB,KAAK,SAASE,EAAOkB,GAE5C9C,EAAE8C,GAAQ7B,KAAK,WAAaiC,EAAcjC,KAAK,wBACjDjB,EAAE8C,GAAQK,KAAK,YAAY,GAC3BD,EAAc5C,SAAS,cAIvB,MAAQ4C,EAAcjC,KAAK,uBAC7BhB,EAAUiD,EAAe,SAASE,GAChCA,EAAWR,KAAK,UAAUlB,KAAK,SAASE,EAAOkB,GAEzC9C,EAAE8C,GAAQ7B,KAAK,WAAamC,EAAWnC,KAAK,qBAC9CjB,EAAE8C,GAAQK,KAAK,YAAY,GAC3BC,EAAW9C,SAAS,iBAShC,IAAI+C,GAAgB,WACd,MAAQrD,EAAE0C,MAAMtB,MAClBpB,EAAE0C,MAAMpC,SAAS,WAEjBN,EAAE0C,MAAMlB,YAAY,WAGxBxB,GAAE,SAAU,kBACTuC,OAAOc,GACP3B,KAAK2B,GAIRrD,EAAE,iBAAiBsD,OAAO,SAASC,GACjCA,EAAEC,gBACF,IAAIC,GAAOf,IACX1C,GAAE0C,MAAMgB,YACN9C,SAAU,OACVU,QAAS,SAASC,GAChBvB,EAAEyD,GAAMb,KAAK,OAAOX,KAAK0B,KAAKC,UAAUrC,EAAOI,MAAO,SAASkC,EAAKC,GAClE,MAAOA,IACN,KAELC,MAAO,SAASC,EAAKC,EAAQC,GAC3B9B,OAAOC,MAAM6B,QAMnBlE,EAAE,iBAAiBsD,OAAO,SAASC,GACjCA,EAAEC,gBACF,IAAIW,GAAQnE,EAAE0C,MACV0B,EAAWD,EAAMvB,KAAK,4BACtBwB,GAASnB,SACXkB,EAAMvB,KAAK,wBAAwBxB,IAAIgD,EAASnD,KAAK,eACrDkD,EAAMT,YACJ9C,SAAU,OACVU,QAAS,SAASC,GAChB4C,EAAMvB,KAAK,OAAOX,KAAK0B,KAAKC,UAAUrC,EAAQ,SAASsC,EAAKC,GAC1D,MAAOA,IACN,KAGLC,MAAO,SAASC,EAAKC,EAAQC,GAC3B9B,OAAOC,MAAM6B","file":"../admin-analytics-helper.js","sourcesContent":["/**\n * Google analytics helper\n */\n\n/*global Gianalytics:false*/\n\njQuery(document).ready(function ($) {\n\n  'use strict';\n\n  // Google Analytics\n  var gaProfile = function(parent, callback){\n    var td = $(parent).parents('td');\n    td.addClass('loading');\n    $.ajax({\n      type: 'GET',\n      url: Gianalytics.endpoint,\n      dataType: 'json',\n      data: {\n        nonce: Gianalytics.nonce,\n        action: Gianalytics.action,\n        target: $(parent).attr('id').replace('ga-', ''),\n        account_id: $('#ga-account').val(),\n        profile_id: $('#ga-profile').val()\n      },\n      success: function(result){\n        td.removeClass('loading');\n        if( result.success ){\n          var select = $('#' + $(parent).attr('data-child'));\n          $.each(result.items, function(index, item){\n            var opt = document.createElement('option');\n            $(opt).attr('value', item.id).text(item.name);\n            select.append(opt);\n          });\n          if( callback ){\n            callback(select);\n          }\n        }else{\n          window.alert(result.message);\n        }\n      }\n    });\n  };\n\n  // Bind profile change.\n  $('.ga-profile-select', '#ga-connection').change(function(){\n    var threshold = parseInt($(this).attr('data-clear-target'), 10);\n    // Clear all\n    $('select', '#ga-connection').each(function(index, elt){\n      if( index >= threshold ){\n        $(elt).find('option').each(function(i, option){\n          if( i > 0 ){\n            $(option).remove();\n          }\n        });\n      }\n    });\n    // Search\n    gaProfile(this);\n  });\n\n  // Fill\n  var accountSelect = $('#ga-account');\n  if( accountSelect.length && '0' !== accountSelect.attr('data-ga-account-id') ){\n    gaProfile(accountSelect, function(profileSelect){\n      profileSelect.find('option').each(function(index, option){\n        // Make select box checked.\n        if( $(option).attr('value') === profileSelect.attr('data-ga-profile-id') ){\n          $(option).prop('selected', true);\n          profileSelect.addClass('success');\n        }\n      });\n      // Ajax\n      if( '0' !== profileSelect.attr('data-ga-profile-id') ){\n        gaProfile(profileSelect, function(viewSelect){\n          viewSelect.find('option').each(function(index, option){\n            // Make select box checked.\n            if( $(option).attr('value') === viewSelect.attr('data-ga-view-id') ){\n              $(option).prop('selected', true);\n              viewSelect.addClass('success');\n            }\n          });\n        });\n      }\n    });\n  }\n\n  // Check status\n  var checkGaStatus = function(){\n    if( '0' !== $(this).val() ){\n      $(this).addClass('success');\n    }else{\n      $(this).removeClass('success');\n    }\n  };\n  $('select', '#ga-connection')\n    .change(checkGaStatus)\n    .each(checkGaStatus);\n\n\n  // Cron checker\n  $('#cron-checker').submit(function(e){\n    e.preventDefault();\n    var form = this;\n    $(this).ajaxSubmit({\n      dataType: 'json',\n      success: function(result){\n        $(form).find('pre').text(JSON.stringify(result.items, function(key, value){\n          return value;\n        }, 4));\n      },\n      error: function(xhr, status, msg){\n        window.alert(msg);\n      }\n    });\n  });\n\n  // Ajax Checker\n  $('#ajax-checker').submit(function(e){\n    e.preventDefault();\n    var $form = $(this),\n        $checked = $form.find(\"input[type=radio]:checked\");\n    if( $checked.length ){\n      $form.find('input[name=_wpnonce]').val($checked.attr('data-nonce'));\n      $form.ajaxSubmit({\n        dataType: 'json',\n        success: function(result){\n          $form.find('pre').text(JSON.stringify(result, function(key, value){\n            return value;\n          }, 4));\n\n        },\n        error: function(xhr, status, msg){\n          window.alert(msg);\n        }\n      });\n    }\n  });\n\n});\n"]}